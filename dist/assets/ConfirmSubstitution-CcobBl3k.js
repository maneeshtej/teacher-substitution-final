import{j as s}from"./index-DcfvNCTE.js";import{b}from"./vendor-xatzf0Rc.js";import{u as j}from"./useTeachStore-oF6TMzqJ.js";import"./AnimationManager-CjR2nXLh.js";import{c as k}from"./fetchUtils-DSPvWvVt.js";import{s as w}from"./postUtils-DUnA86lR.js";import{s as y,u as O,L as S}from"./App-BarifcCs.js";import"./recentFunctionUtils-DfT13bYP.js";const C=async f=>{if(!f||Object.keys(f).length===0)return{};const t=Object.keys(f).map(async i=>{const l=f[i],{data:x,error:p}=await y.from("Substitution").select("sub_id").eq("class_id",l.class_id).eq("date_of_period",l.date_of_period).eq("deleted",!1).limit(1);return p?(console.error("Error checking duplicates:",p),{key:i,duplicate:!1}):{key:i,duplicate:x.length>0}}),u=await Promise.all(t);return console.log(u),u.reduce((i,{key:l,duplicate:x})=>(i[l]=x,i),{})};function $(){const{setteachersubstitutionstosend:f}=j(),[t,u]=b.useState(j(e=>e.teachersubstitutionstosend)||{}),i=j(e=>e.teacherid),[l,x]=b.useState(null),p=O(),g=e=>{if(!e){console.error("error : no classItem");return}u(c=>{var o;return{...c,[e]:{...c[e],selected:!((o=c[e])!=null&&o.selected)}}})},v=()=>{u(e=>{var o;const c={...e};for(let d in c)(o=c[d])!=null&&o.selected&&delete c[d];return f(c),c})},N=async()=>{const e=Object.keys(t).filter(n=>{var r;return(r=t[n])==null?void 0:r.selected}).reduce((n,r)=>({...n,[r]:t[r]}),{});if(Object.keys(e).length===0){console.warn("No substitutions selected to send.");return}const c=await C(e);let o=!1;const d={...t};if(Object.keys(c).forEach(n=>{d[n]&&(d[n].duplicate=c[n],c[n]&&(o=!0))}),u(d),o){console.error("Duplicates found! Sending aborted.");return}const m=await w(e);u(n=>{const r={...n};return Object.keys(r).forEach(a=>{var h;(h=r[a])!=null&&h.selected&&delete r[a]}),r}),console.log(m),p("/success",{state:{data:t}})};return b.useEffect(()=>{console.log(t)},[t]),b.useEffect(()=>{(async()=>{const{data:c,error:o}=await k(i);o&&console.error("error : ",o),x(c)})()},[i]),b.useEffect(()=>{console.log(l)},[l]),s.jsxs("div",{className:"fixed flex flex-col h-[100dvh] w-[100vw] bg-backgroundc text-textc px-[20px]  py-[20px]",children:[s.jsxs("div",{className:"flex flex-row items-center justify-between min-h-[7dvh]",children:[s.jsx("button",{className:"font-extralight cursor-pointer",onClick:()=>{p("/addsubstitution")},children:"Back"}),s.jsx("button",{className:"font-extralight",onClick:()=>{N()},children:"Send"})]}),s.jsx("div",{className:"h-[10dvh] flex items-center pl-[min(6vw,50px)]",children:s.jsx("span",{className:"font-medium text-3xl",children:"Selected Classes"})}),s.jsxs("div",{className:"h-[83dvh] px-[min(12vw,100px)] flex flex-col gap-[20px] overflow-y-scroll",children:[s.jsxs("div",{className:"w-[100%] flex flex-row justify-end gap-[20px] font-light",children:[s.jsx("button",{children:"Draft"}),s.jsx("button",{className:"text-red-300 transition-all duration-200 ease-in-out",style:{color:Object.values(t).some(e=>e.selected)?"red":"rgb(170,170,170)",cursor:Object.values(t).some(e=>e.selected)?"pointer":"default"},onClick:v,disabled:!Object.values(t).some(e=>e.selected),children:"Delete"})]}),t&&Object.keys(t).length>0?Object.keys(t).map((e,c)=>{var o,d,m;return s.jsx("div",{className:"flex flex-col bg-[rgb(30,30,30)] rounded-[10px] p-[15px] transition-all duration-200 ease-in-out",onClick:()=>g(e),style:{backgroundColor:(o=t[e])!=null&&o.duplicate?"red":(d=t[e])!=null&&d.selected?"white":"",color:(m=t[e])!=null&&m.selected?"black":""},children:t[e]&&Object.keys(t[e]).length>0?Object.keys(t[e]).map((n,r)=>s.jsxs("span",{children:[r===0&&s.jsxs("span",{className:"block",onClick:a=>{a.stopPropagation()},children:["Teacher :"," ",s.jsxs("select",{name:"Teacher",onChange:a=>{console.log(a.target.value),u(h=>({...h,[e]:{...h[e],sub_teacher_id:a.target.value.split("-")[0],sub_teacher_name:a.target.value.split("-")[1]}}))},children:[s.jsx("option",{className:"bg-backgroundc text-textc",value:null,children:"None"}),l&&Object.keys(l).length>0?Object.keys(l).map((a,h)=>s.jsx("option",{value:`${l[a].id}-${l[a].name}`,className:"bg-backgroundc text-textc",children:l[a].name},h)):s.jsx("option",{children:"None"})]})]}),n," : ",t[e][n]]},r)):s.jsx("div",{className:"",children:"No Classes"})},c)}):s.jsx("div",{className:"h-[100%] w-[100%] flex flex-col items-center justify-center",children:s.jsx(S,{to:"/home",children:"Go to home"})})]})]})}export{$ as default};
